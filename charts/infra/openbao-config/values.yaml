apiVersion: v2
name: openbao-config
description: OpenBao with Kubernetes auth configuration for apps and infra
type: application
version: 0.1.0
appVersion: "2.0.0"

dependencies:
  - name: openbao
    version: "0.6.0"
    repository: "https://openbao.github.io/openbao-helm"
    condition: openbao.enabled

# OpenBao subchart configuration
openbao:
  enabled: true
  server:
    dev:
      enabled: false
    standalone:
      enabled: true
    dataStorage:
      enabled: true
      size: 1Gi
    service:
      type: ClusterIP

# Initialization configuration
init:
  enabled: true
  image:
    repository: openbao/openbao
    tag: "2.0.0"
    pullPolicy: IfNotPresent

  # Root token (НЕ класть сюда в Git, задавать через --set init.rootToken=...)
  rootToken: ""

  # Kubernetes auth configuration
  kubernetesAuth:
    enabled: true
    path: kubernetes

# Secrets engine configuration
secretsEngines:
  - path: secret
    type: kv-v2
    description: "KV Version 2 secret engine"

# Конфигурация для namespaces (без значений секретов)
namespaces:
  kafka:
    enabled: true
    serviceAccounts:
      - name: kafka-sa
        namespace: kafka
    policies:
      - name: kafka-policy
        rules: |
          path "secret/data/kafka/*" {
            capabilities = ["read", "list"]
          }
          path "secret/metadata/kafka/*" {
            capabilities = ["read", "list"]
          }
    roles:
      - name: kafka
        boundServiceAccountNames:
          - kafka-sa
        boundServiceAccountNamespaces:
          - kafka
        policies:
          - kafka-policy
        ttl: 1h

# ServiceAccounts to create
serviceAccounts:
  create: true

# ClusterRoleBindings for auth-delegator
authDelegator:
  create: true